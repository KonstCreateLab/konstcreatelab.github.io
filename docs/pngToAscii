<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä PNG –≤ ASCII</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #1a1a2e;
            color: #e6e6e6;
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #2d4059;
        }
        
        h1 {
            color: #4cc9f0;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .subtitle {
            color: #a0a0a0;
            font-size: 1.1rem;
        }
        
        .main-content {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .upload-section, .controls-section, .output-section {
            background-color: #16213e;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .upload-section {
            flex: 1;
            min-width: 300px;
        }
        
        .controls-section {
            flex: 1;
            min-width: 300px;
        }
        
        .output-section {
            flex: 100%;
            min-width: 300px;
        }
        
        h2 {
            color: #3f72af;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #2d4059;
        }
        
        .upload-area {
            border: 3px dashed #3f72af;
            border-radius: 10px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 20px;
        }
        
        .upload-area:hover, .upload-area.dragover {
            background-color: rgba(63, 114, 175, 0.1);
            border-color: #4cc9f0;
        }
        
        .upload-area i {
            font-size: 3rem;
            color: #4cc9f0;
            margin-bottom: 15px;
        }
        
        .file-input {
            display: none;
        }
        
        .preview-container {
            display: flex;
            justify-content: center;
            margin-top: 20px;
        }
        
        #imagePreview {
            max-width: 100%;
            max-height: 200px;
            border-radius: 5px;
            display: none;
        }
        
        .control-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #a0a0a0;
        }
        
        input[type="range"] {
            width: 100%;
            height: 10px;
            background: #2d4059;
            border-radius: 5px;
            outline: none;
            -webkit-appearance: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: #4cc9f0;
            border-radius: 50%;
            cursor: pointer;
        }
        
        .range-value {
            display: inline-block;
            margin-left: 10px;
            color: #4cc9f0;
            font-weight: bold;
        }
        
        select, button {
            width: 100%;
            padding: 12px 15px;
            background-color: #2d4059;
            color: #e6e6e6;
            border: none;
            border-radius: 5px;
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        button {
            background-color: #3f72af;
            font-weight: bold;
            margin-top: 10px;
        }
        
        button:hover {
            background-color: #4cc9f0;
        }
        
        .char-palette {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 10px;
        }
        
        .char-option {
            padding: 5px 10px;
            background-color: #2d4059;
            border-radius: 3px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .char-option:hover, .char-option.selected {
            background-color: #4cc9f0;
            color: #16213e;
        }
        
        .output-container {
            background-color: #0f1525;
            border-radius: 5px;
            padding: 20px;
            overflow: auto;
            max-height: 500px;
            font-family: 'Courier New', monospace;
            line-height: 1;
            white-space: pre;
            margin-top: 20px;
        }
        
        .output-controls {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .output-controls button {
            flex: 1;
        }
        
        footer {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #2d4059;
            color: #a0a0a0;
            font-size: 0.9rem;
        }
        
        .loading {
            display: none;
            text-align: center;
            margin: 20px 0;
        }
        
        .spinner {
            border: 5px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border-top: 5px solid #4cc9f0;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>–ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä PNG –≤ ASCII</h1>
            <p class="subtitle">–ó–∞–≥—Ä—É–∑–∏—Ç–µ PNG –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏ –ø—Ä–µ–æ–±—Ä–∞–∑—É–π—Ç–µ –µ–≥–æ –≤ ASCII-–∞—Ä—Ç –ø—Ä—è–º–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ</p>
        </header>
        
        <div class="main-content">
            <div class="upload-section">
                <h2>–ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</h2>
                <div class="upload-area" id="uploadArea">
                    <div class="upload-icon">üìÅ</div>
                    <p>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ PNG —Ñ–∞–π–ª —Å—é–¥–∞ –∏–ª–∏ –∫–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞</p>
                    <input type="file" id="fileInput" class="file-input" accept=".png">
                </div>
                <p>–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–∏–º–µ—Ä:</p>
                <button id="sampleButton">–ó–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–∏–º–µ—Ä</button>
                
                <div class="preview-container">
                    <img id="imagePreview" alt="–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä">
                </div>
            </div>
            
            <div class="controls-section">
                <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏</h2>
                
                <div class="control-group">
                    <label for="widthRange">–®–∏—Ä–∏–Ω–∞ ASCII (—Å–∏–º–≤–æ–ª–æ–≤): <span id="widthValue" class="range-value">80</span></label>
                    <input type="range" id="widthRange" min="20" max="200" value="80">
                </div>
                
                <div class="control-group">
                    <label for="contrastRange">–ö–æ–Ω—Ç—Ä–∞—Å—Ç–Ω–æ—Å—Ç—å: <span id="contrastValue" class="range-value">1.0</span></label>
                    <input type="range" id="contrastRange" min="0.1" max="3.0" step="0.1" value="1.0">
                </div>
                
                <div class="control-group">
                    <label for="paletteSelect">–ü–∞–ª–∏—Ç—Ä–∞ —Å–∏–º–≤–æ–ª–æ–≤:</label>
                    <select id="paletteSelect">
                        <option value="standard">–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è (@%#*+=-:. )</option>
                        <option value="dense">–ü–ª–æ—Ç–Ω–∞—è ($@B%8&WM#*oahkbdpqwmZO0QLCJUYXzcvunxrjft/\|()1{}[]?-_+~<>i!lI;:,"^`'. )</option>
                        <option value="simple">–ü—Ä–æ—Å—Ç–∞—è (@%#*+=-:. )</option>
                        <option value="blocks">–ë–ª–æ—á–Ω–∞—è (‚ñà‚ñì‚ñí‚ñë )</option>
                        <option value="custom">–°–≤–æ—è...</option>
                    </select>
                    
                    <div class="char-palette" id="charPalette">
                        <div class="char-option" data-char="@">@</div>
                        <div class="char-option" data-char="%">%</div>
                        <div class="char-option" data-char="#">#</div>
                        <div class="char-option" data-char="*">*</div>
                        <div class="char-option" data-char="+">+</div>
                        <div class="char-option" data-char="=">=</div>
                        <div class="char-option" data-char="-">-</div>
                        <div class="char-option" data-char=":">:</div>
                        <div class="char-option" data-char=".">.</div>
                        <div class="char-option" data-char=" "> </div>
                    </div>
                    
                    <input type="text" id="customPalette" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–∏–º–≤–æ–ª—ã –æ—Ç —Ç–µ–º–Ω—ã—Ö –∫ —Å–≤–µ—Ç–ª—ã–º" style="display: none; width: 100%; margin-top: 10px; padding: 10px; background-color: #2d4059; color: #e6e6e6; border: none; border-radius: 5px;">
                </div>
                
                <div class="control-group">
                    <label for="invertToggle">–ò–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ü–≤–µ—Ç–∞:</label>
                    <select id="invertToggle">
                        <option value="false">–ù–µ—Ç</option>
                        <option value="true">–î–∞</option>
                    </select>
                </div>
                
                <button id="convertButton">–ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ ASCII</button>
                
                <div class="loading" id="loadingIndicator">
                    <div class="spinner"></div>
                    <p>–ò–¥–µ—Ç –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è...</p>
                </div>
            </div>
            
            <div class="output-section">
                <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç ASCII-–∞—Ä—Ç</h2>
                <div class="output-controls">
                    <button id="copyButton">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞</button>
                    <button id="downloadButton">–°–∫–∞—á–∞—Ç—å –∫–∞–∫ TXT</button>
                    <button id="clearButton">–û—á–∏—Å—Ç–∏—Ç—å</button>
                </div>
                <div class="output-container" id="outputContainer">
                    <p style="text-align: center; color: #666;">–ó–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏</p>
                </div>
            </div>
        </div>
        
        <footer>
            <p>–ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤ –≤–∞—à–µ–º –±—Ä–∞—É–∑–µ—Ä–µ. –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä.</p>
            <p>¬© 2023 –ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä PNG –≤ ASCII. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
        </footer>
    </div>

    <script>
        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const fileInput = document.getElementById('fileInput');
        const uploadArea = document.getElementById('uploadArea');
        const imagePreview = document.getElementById('imagePreview');
        const widthRange = document.getElementById('widthRange');
        const widthValue = document.getElementById('widthValue');
        const contrastRange = document.getElementById('contrastRange');
        const contrastValue = document.getElementById('contrastValue');
        const paletteSelect = document.getElementById('paletteSelect');
        const charPalette = document.getElementById('charPalette');
        const customPalette = document.getElementById('customPalette');
        const invertToggle = document.getElementById('invertToggle');
        const convertButton = document.getElementById('convertButton');
        const copyButton = document.getElementById('copyButton');
        const downloadButton = document.getElementById('downloadButton');
        const clearButton = document.getElementById('clearButton');
        const outputContainer = document.getElementById('outputContainer');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const sampleButton = document.getElementById('sampleButton');
        
        // –ü–∞–ª–∏—Ç—Ä—ã —Å–∏–º–≤–æ–ª–æ–≤ (–æ—Ç —Å–∞–º—ã—Ö —Ç–µ–º–Ω—ã—Ö –∫ —Å–∞–º—ã–º —Å–≤–µ—Ç–ª—ã–º)
        const palettes = {
            standard: '@%#*+=-:. ',
            dense: '$@B%8&WM#*oahkbdpqwmZO0QLCJUYXzcvunxrjft/\\|()1{}[]?-_+~<>i!lI;:,"^`\'. ',
            simple: '@%#*+=-:. ',
            blocks: '‚ñà‚ñì‚ñí‚ñë '
        };
        
        // –¢–µ–∫—É—â–µ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
        let currentImage = null;
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        function init() {
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π –ø–æ–ª–∑—É–Ω–∫–æ–≤
            widthRange.addEventListener('input', () => {
                widthValue.textContent = widthRange.value;
            });
            
            contrastRange.addEventListener('input', () => {
                contrastValue.textContent = contrastRange.value;
            });
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ –ø–∞–ª–∏—Ç—Ä—ã
            paletteSelect.addEventListener('change', () => {
                const selectedPalette = paletteSelect.value;
                
                if (selectedPalette === 'custom') {
                    customPalette.style.display = 'block';
                    charPalette.style.display = 'none';
                } else {
                    customPalette.style.display = 'none';
                    charPalette.style.display = 'flex';
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –ø–∞–ª–∏—Ç—Ä—É —Å–∏–º–≤–æ–ª–æ–≤
                    updateCharPalette(palettes[selectedPalette]);
                }
            });
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–æ–≤ –ø–æ —Å–∏–º–≤–æ–ª–∞–º –≤ –ø–∞–ª–∏—Ç—Ä–µ
            charPalette.addEventListener('click', (e) => {
                if (e.target.classList.contains('char-option')) {
                    // –£–±–∏—Ä–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —É –≤—Å–µ—Ö —Å–∏–º–≤–æ–ª–æ–≤
                    document.querySelectorAll('.char-option').forEach(el => {
                        el.classList.remove('selected');
                    });
                    
                    // –í—ã–¥–µ–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Å–∏–º–≤–æ–ª
                    e.target.classList.add('selected');
                    
                    // –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–∞ –∫–∞—Å—Ç–æ–º–Ω–∞—è –ø–∞–ª–∏—Ç—Ä–∞, –¥–æ–±–∞–≤–ª—è–µ–º —Å–∏–º–≤–æ–ª –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞
                    if (paletteSelect.value === 'custom') {
                        const currentValue = customPalette.value;
                        const clickedChar = e.target.getAttribute('data-char');
                        customPalette.value = currentValue + clickedChar;
                    }
                }
            });
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞
            uploadArea.addEventListener('click', () => fileInput.click());
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });
            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                
                if (e.dataTransfer.files.length) {
                    const file = e.dataTransfer.files[0];
                    if (file.type === 'image/png') {
                        loadImage(file);
                    } else {
                        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–≥—Ä—É–∑–∏—Ç–µ PNG —Ñ–∞–π–ª');
                    }
                }
            });
            
            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length) {
                    const file = e.target.files[0];
                    loadImage(file);
                }
            });
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏–º–µ—Ä–∞
            sampleButton.addEventListener('click', loadSampleImage);
            
            // –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è
            convertButton.addEventListener('click', convertToAscii);
            
            // –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ
            copyButton.addEventListener('click', copyToClipboard);
            
            // –°–∫–∞—á–∏–≤–∞–Ω–∏–µ
            downloadButton.addEventListener('click', downloadAsText);
            
            // –û—á–∏—Å—Ç–∫–∞
            clearButton.addEventListener('click', clearOutput);
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–∞–ª–∏—Ç—Ä—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            updateCharPalette(palettes.standard);
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞–ª–∏—Ç—Ä—ã —Å–∏–º–≤–æ–ª–æ–≤
        function updateCharPalette(chars) {
            charPalette.innerHTML = '';
            
            for (let char of chars) {
                const charEl = document.createElement('div');
                charEl.className = 'char-option';
                charEl.setAttribute('data-char', char);
                charEl.textContent = char === ' ' ? '‚éµ' : char;
                charPalette.appendChild(charEl);
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        function loadImage(file) {
            const reader = new FileReader();
            
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    currentImage = img;
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–≤—å—é
                    imagePreview.src = img.src;
                    imagePreview.style.display = 'block';
                    
                    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º
                    setTimeout(convertToAscii, 300);
                };
                img.src = e.target.result;
            };
            
            reader.readAsDataURL(file);
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏–º–µ—Ä–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        function loadSampleImage() {
            // –°–æ–∑–¥–∞–µ–º –ø—Ä–æ—Å—Ç–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å –ø–æ–º–æ—â—å—é Canvas
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            canvas.width = 200;
            canvas.height = 150;
            
            // –†–∏—Å—É–µ–º –ø—Ä–æ—Å—Ç–æ–π –ø–µ–π–∑–∞–∂
            // –ù–µ–±–æ
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, '#4A90E2');
            gradient.addColorStop(1, '#87CEEB');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // –°–æ–ª–Ω—Ü–µ
            ctx.fillStyle = '#FFD700';
            ctx.beginPath();
            ctx.arc(160, 40, 20, 0, Math.PI * 2);
            ctx.fill();
            
            // –ì–æ—Ä—ã
            ctx.fillStyle = '#2E8B57';
            ctx.beginPath();
            ctx.moveTo(0, 100);
            ctx.lineTo(40, 40);
            ctx.lineTo(80, 80);
            ctx.lineTo(120, 30);
            ctx.lineTo(160, 70);
            ctx.lineTo(200, 20);
            ctx.lineTo(200, 150);
            ctx.lineTo(0, 150);
            ctx.closePath();
            ctx.fill();
            
            // –î–µ—Ä–µ–≤–æ
            ctx.fillStyle = '#8B4513';
            ctx.fillRect(100, 80, 10, 30);
            ctx.fillStyle = '#228B22';
            ctx.beginPath();
            ctx.arc(105, 70, 25, 0, Math.PI * 2);
            ctx.fill();
            
            // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º canvas –≤ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            const img = new Image();
            img.onload = function() {
                currentImage = img;
                imagePreview.src = img.src;
                imagePreview.style.display = 'block';
                
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º
                setTimeout(convertToAscii, 300);
            };
            img.src = canvas.toDataURL('image/png');
        }
        
        // –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ ASCII
        function convertToAscii() {
            if (!currentImage) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ');
                return;
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
            loadingIndicator.style.display = 'block';
            outputContainer.innerHTML = '<p>–ò–¥–µ—Ç –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è...</p>';
            
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º setTimeout —á—Ç–æ–±—ã –¥–∞—Ç—å –±—Ä–∞—É–∑–µ—Ä—É –æ–±–Ω–æ–≤–∏—Ç—å UI
            setTimeout(() => {
                try {
                    // –ü–æ–ª—É—á–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                    const asciiWidth = parseInt(widthRange.value);
                    const contrast = parseFloat(contrastRange.value);
                    const invert = invertToggle.value === 'true';
                    
                    // –ü–æ–ª—É—á–∞–µ–º –ø–∞–ª–∏—Ç—Ä—É —Å–∏–º–≤–æ–ª–æ–≤
                    let palette;
                    if (paletteSelect.value === 'custom' && customPalette.value.trim()) {
                        palette = customPalette.value;
                    } else if (paletteSelect.value === 'custom') {
                        palette = palettes.standard;
                    } else {
                        palette = palettes[paletteSelect.value];
                    }
                    
                    // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º
                    const asciiArt = imageToAscii(
                        currentImage, 
                        asciiWidth, 
                        palette, 
                        contrast, 
                        invert
                    );
                    
                    // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                    outputContainer.textContent = asciiArt;
                    
                    // –°–∫—Ä—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
                    loadingIndicator.style.display = 'none';
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏:', error);
                    alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏: ' + error.message);
                    loadingIndicator.style.display = 'none';
                }
            }, 50);
        }
        
        // –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ ASCII
        function imageToAscii(img, asciiWidth, palette, contrast, invert) {
            // –°–æ–∑–¥–∞–µ–º canvas –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –≤—ã—Å–æ—Ç—É ASCII —Å —É—á–µ—Ç–æ–º –ø—Ä–æ–ø–æ—Ä—Ü–∏–π
            const asciiHeight = Math.floor(asciiWidth * (img.height / img.width) * 0.5);
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä—ã canvas
            canvas.width = asciiWidth;
            canvas.height = asciiHeight;
            
            // –†–∏—Å—É–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞ canvas
            ctx.drawImage(img, 0, 0, asciiWidth, asciiHeight);
            
            // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–∏–∫—Å–µ–ª–µ–π
            const imageData = ctx.getImageData(0, 0, asciiWidth, asciiHeight);
            const data = imageData.data;
            
            // –°—Ç—Ä–æ–∏–º ASCII –∞—Ä—Ç
            let asciiArt = '';
            
            for (let y = 0; y < asciiHeight; y++) {
                for (let x = 0; x < asciiWidth; x++) {
                    // –ò–Ω–¥–µ–∫—Å –ø–∏–∫—Å–µ–ª—è –≤ –º–∞—Å—Å–∏–≤–µ –¥–∞–Ω–Ω—ã—Ö
                    const idx = (y * asciiWidth + x) * 4;
                    
                    // –ü–æ–ª—É—á–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è RGB
                    let r = data[idx];
                    let g = data[idx + 1];
                    let b = data[idx + 2];
                    
                    // –ü—Ä–∏–º–µ–Ω—è–µ–º –∫–æ–Ω—Ç—Ä–∞—Å—Ç–Ω–æ—Å—Ç—å
                    r = applyContrast(r, contrast);
                    g = applyContrast(g, contrast);
                    b = applyContrast(b, contrast);
                    
                    // –í—ã—á–∏—Å–ª—è–µ–º —è—Ä–∫–æ—Å—Ç—å (—Ñ–æ—Ä–º—É–ª–∞ –∏–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞ ITU-R BT.709)
                    let brightness = 0.2126 * r + 0.7152 * g + 0.0722 * b;
                    
                    // –ò–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
                    if (invert) {
                        brightness = 255 - brightness;
                    }
                    
                    // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º —è—Ä–∫–æ—Å—Ç—å –∫ –¥–∏–∞–ø–∞–∑–æ–Ω—É 0-1
                    const normalizedBrightness = brightness / 255;
                    
                    // –í—ã–±–∏—Ä–∞–µ–º —Å–∏–º–≤–æ–ª –∏–∑ –ø–∞–ª–∏—Ç—Ä—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ —è—Ä–∫–æ—Å—Ç–∏
                    const charIndex = Math.floor(normalizedBrightness * (palette.length - 1));
                    const char = palette.charAt(charIndex);
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º —Å–∏–º–≤–æ–ª –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                    asciiArt += char;
                }
                // –î–æ–±–∞–≤–ª—è–µ–º –ø–µ—Ä–µ–Ω–æ—Å —Å—Ç—Ä–æ–∫–∏
                asciiArt += '\n';
            }
            
            return asciiArt;
        }
        
        // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ç—Ä–∞—Å—Ç–Ω–æ—Å—Ç–∏ –∫ –∑–Ω–∞—á–µ–Ω–∏—é —Ü–≤–µ—Ç–∞
        function applyContrast(value, contrast) {
            // –ü—Ä–∏–≤–æ–¥–∏–º –∑–Ω–∞—á–µ–Ω–∏–µ –∫ –¥–∏–∞–ø–∞–∑–æ–Ω—É 0-1
            let normalized = value / 255;
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º –∫–æ–Ω—Ç—Ä–∞—Å—Ç–Ω–æ—Å—Ç—å
            normalized = (normalized - 0.5) * contrast + 0.5;
            
            // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è
            normalized = Math.max(0, Math.min(1, normalized));
            
            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫ –¥–∏–∞–ø–∞–∑–æ–Ω—É 0-255
            return Math.floor(normalized * 255);
        }
        
        // –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
        function copyToClipboard() {
            const asciiText = outputContainer.textContent;
            
            if (!asciiText || asciiText.includes('–ó–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç')) {
                alert('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è');
                return;
            }
            
            navigator.clipboard.writeText(asciiText)
                .then(() => {
                    // –í–∏–∑—É–∞–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
                    const originalText = copyButton.textContent;
                    copyButton.textContent = '–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!';
                    copyButton.style.backgroundColor = '#2E8B57';
                    
                    setTimeout(() => {
                        copyButton.textContent = originalText;
                        copyButton.style.backgroundColor = '';
                    }, 2000);
                })
                .catch(err => {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–∏: ', err);
                    alert('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç');
                });
        }
        
        // –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –∫–∞–∫ TXT —Ñ–∞–π–ª
        function downloadAsText() {
            const asciiText = outputContainer.textContent;
            
            if (!asciiText || asciiText.includes('–ó–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç')) {
                alert('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è');
                return;
            }
            
            const blob = new Blob([asciiText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = 'ascii-art.txt';
            document.body.appendChild(a);
            a.click();
            
            // –û—á–∏—Å—Ç–∫–∞
            setTimeout(() => {
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }, 100);
        }
        
        // –û—á–∏—Å—Ç–∫–∞ –≤—ã–≤–æ–¥–∞
        function clearOutput() {
            outputContainer.innerHTML = '<p style="text-align: center; color: #666;">–ó–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏</p>';
            imagePreview.style.display = 'none';
            currentImage = null;
            fileInput.value = '';
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
